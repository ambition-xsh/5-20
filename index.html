<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form and Meeting Booking</title>
  <!-- Element Plus CSS -->
  <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
  <!-- Sortable.js -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <!-- Element Plus -->
  <script src="https://unpkg.com/element-plus"></script>
  <!-- Element Plus Icons -->
  <script src="https://unpkg.com/@element-plus/icons-vue"></script>
  <!-- Axios -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <style>
    /* BookMeeting Component Styles */
    .el-dialog {
      border-radius: 12px;
    }
    
    .step-container {
      min-height: 220px;
    }
    
    .manager-info {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .manager-label {
      font-size: 18px;
      margin-right: 18px;
    }
    
    .avatar-container {
      display: flex;
      align-items: center;
    }
    
    .manager-name {
      margin-left: 18px;
      font-size: 18px;
    }
    
    .meeting-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 15px;
      margin-top: 5px;
    }
    
    .time-zone {
      font-size: 16px;
      margin-bottom: 15px;
    }
    
    .date-tabs {
      display: flex;
      flex-wrap: nowrap;
      gap: 10px;
      padding: 4px 0px;
      width: 1000px;
    }
    
    .date-tab {
      cursor: pointer;
      transition: all 0.3s;
      background-color: transparent;
      border-radius: 0;
      position: relative;
      flex: 1;
      text-align: center;
    }
    
    .date-tab.active {
      background-color: transparent;
      color: #409eff;
      font-weight: bold;
      width: 60px;
    }
    
    .time-slots {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      overflow-y: auto;
    }
    
    .time-slot {
      padding: 10px;
      border: 1px solid #dcdfe6;
      border-radius: 4px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .time-slot:hover:not(.disabled) {
      border-color: #409eff;
    }
    
    .time-slot.selected {
      background-color: #ecf5ff;
      border-color: #409eff;
      color: #409eff;
    }
    
    .time-slot.disabled {
      background-color: #f5f7fa;
      color: #c0c4cc;
      cursor: not-allowed;
    }
    
    .selected-time-info {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      margin-top: 5px;
    }
    
    .reselect-btn {
      font-size: 14px;
      color: #79bbff;
    }
    
    .booking-form {
      margin-top: 20px;
    }
    
    .booking-form .el-form-item {
      margin-bottom: 15px;
    }
    
    .inline-form-item {
      display: flex;
      align-items: center;
    }
    
    .el-input {
      height: 32px;
    }
    
    .inline-form-item .el-form-item__label {
      width: 80px;
      text-align: left;
      padding-right: 12px;
      line-height: 32px;
      white-space: nowrap;
    }
    
    .inline-form-item .el-form-item__content {
      flex: 1;
      margin-left: 0 !important;
    }
    
    .confirm-btn {
      width: 36%;
      margin: 20px auto 0;
      display: block;
    }
    
    .success-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 10px 0;
    }
    
    .success-icon {
      width: 80px;
      height: 80px;
      background-color: #67c23a;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    .check-icon {
      color: white;
      font-size: 40px;
    }
    
    .success-title {
      margin-bottom: 20px;
    }
    
    .meeting-info {
      margin-bottom: 20px;
      padding: 15px;
      width: 80%;
      text-align: center;
    }
    
    .meeting-time,
    .meeting-link {
      margin-bottom: 5px;
    }
    
    .link-text {
      word-break: break-all;
    }
    
    .copy-btn {
      width: 36%;
    }
    
    .fresh-btn {
      margin-top: 12px;
    }
    
    .fade-enter-active,
    .fade-leave-active {
      transition: opacity 0.3s, transform 0.3s;
    }
    
    .fade-enter-from,
    .fade-leave-to {
      opacity: 0;
      transform: translateY(10px);
    }

    /* Dynamic Form Styles */
    .dynamic-form {
      max-width: 600px;
      margin: 12px auto;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: #f9f9f9;
    }
    
    .form-tilte {
      text-align: center;
      font-size: 24px;
    }
    
    .form-desc {
      text-align: center;
      font-size: 16px;
      line-height: 32px;
      color: #aaaaaa;
      margin-bottom: 12px;
    }
    
    .dynamic-form-submit {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      max-width: 600px;
      margin: 0 auto;
      padding: 80px 20px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: #fff;
    }
    
    .submit-img {
      margin-bottom: 36px;
    }
    
    .submit-desc {
      font-size: 18px;
      margin-bottom: 12px;
    }
    
    .bookmeeting-btn {
      background-color: #2563eb;
      color: #fff;
      border-radius: 8px;
    }
    
    .form-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      min-height: 100px;
    }
    
    .form-item {
      padding: 16px;
      border: 1px solid #eee;
      border-radius: 8px;
      background-color: #fff;
      position: relative;
    }
    
    .label {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    
    .desc {
      font-size: 12px;
      color: #666;
      margin-bottom: 8px;
    }
    
    .drag-handle {
      position: absolute;
      top: 16px;
      right: 16px;
      cursor: move;
      color: #999;
    }
  </style>
</head>
<body>
  <div id="app">
    <dynamic-form></dynamic-form>
  </div>

  <script>
    // Define BookMeeting component
    const BookMeeting = {
      template: `
        <el-dialog v-model="dialogVisible" width="480px" :show-close="true" :close-on-click-modal="false"
            :close-on-press-escape="true" @close="resetDialog" @open="openDialog">
            <template #header>
                <div class="my-header">
                    <h2 style="text-align: center;font-size: 24px;">会议预约</h2>
                </div>
            </template>
            <template #default>
                <div>
                    <transition name="fade" mode="out-in">
                        <div v-if="currentStep === 1" class="step-container">
                            <div class="manager-info">
                                <span class="manager-label">销售经理：</span>
                                <div class="avatar-container">
                                    <el-avatar :size="40" :src="avatarUrl"></el-avatar>
                                    <span class="manager-name">{{ avatarName }}</span>
                                </div>
                            </div>
                            <h2 class="meeting-title">Google会议</h2>
                            <div class="time-selection">
                                <p class="time-zone">可预约时间 (GMT+08:00)：</p>
                                <div style="overflow-x: auto;margin-bottom: 20px;">
                                    <div class="date-tabs">
                                        <div v-for="date in availableDates" :key="date.value"
                                            :class="['date-tab', { active: selectedDate === date.value }]"
                                            @click="selectedDate = date.value">
                                            {{ date.label }}
                                        </div>
                                    </div>
                                </div>
                                <div class="time-slots">
                                    <div v-for="timeSlot in filteredTimeSlots" :key="timeSlot.starts_at" :class="['time-slot', {
                                        'disabled': timeSlot.available_bookings <= 0,
                                        'selected': selectedTimeSlot && selectedTimeSlot.starts_at === timeSlot.starts_at
                                    }]" @click="selectTimeSlot(timeSlot)">
                                        {{ formatTime(timeSlot.starts_at) }}
                                    </div>
                                </div>
                                <div v-if="!filteredTimeSlots.length" style="line-height: 40px;color: #e7a542;">您选择的日期没有可预约的时间</div>
                            </div>
                        </div>
                        <div v-else-if="currentStep === 2" class="step-container step-form">
                            <div class="manager-info">
                                <span class="manager-label">销售经理：</span>
                                <div class="avatar-container">
                                    <el-avatar :size="40" :src="avatarUrl"></el-avatar>
                                    <span class="manager-name">{{ avatarName }}</span>
                                </div>
                            </div>
                            <div class="selected-time-info">
                                <p>您已经选择时间 {{ formatDateTime(selectedTimeSlot) }}</p>
                                <el-button @click="goToStep(1)" class="reselect-btn" round>重新选择</el-button>
                            </div>
                            <el-form :model="formData" ref="formRef" :rules="rules" label-position="left"
                                class="booking-form">
                                <el-form-item label="您的称呼：" prop="name" class="inline-form-item">
                                    <el-input v-model="formData.name" placeholder="请输入"></el-input>
                                </el-form-item>
                                <el-form-item label="联系方式：" prop="email" class="inline-form-item">
                                    <el-input v-model="formData.email" placeholder="请输入"></el-input>
                                </el-form-item>
                                <el-button type="primary" @click="confirmBooking" :loading="loading"
                                    class="confirm-btn">确定预约</el-button>
                            </el-form>
                        </div>
                        <div v-else-if="currentStep === 3" class="step-container success-container">
                            <div class="success-icon">
                                <el-icon class="check-icon">
                                    <Check />
                                </el-icon>
                            </div>
                            <h2 class="success-title">预约会议成功</h2>
                            <div class="meeting-info">
                                <p class="meeting-time">会议时间：{{ formatDateTime(selectedTimeSlot) }}</p>
                                <p class="meeting-link" v-loading="urlLoading">Google会议链接：</p>
                                <p class="link-text">{{ meeting_url }}</p>
                            </div>
                            <el-button type="primary" @click="copyMeetingInfo" class="copy-btn"
                                v-loading="urlLoading">复制会议信息</el-button>
                        </div>
                    </transition>
                </div>
            </template>
        </el-dialog>
      `,
      props: {
        visible: {
          type: Boolean,
          default: false
        },
        submit_id: {
          type: String,
          default: ''
        }
      },
      setup(props, { emit }) {
        const { ref, computed, reactive, onMounted, watch } = Vue;
        const Check = ElementPlusIconsVue.Check;
        
        const avatarUrl = ref('');
        const avatarName = ref('');
        const meeting_id = ref(props.submit_id);
        
        // 固定值
        const baseUrl = ref('https://192.168.0.16:8891'); // 请替换为您的实际API基础URL
        const formId = ref('qrGDGOaTqOKX');
        
        const dialogVisible = computed({
          get: () => props.visible,
          set: (val) => emit('update:visible', val)
        });
        
        const currentStep = ref(1);
        
        const formData = reactive({
          name: '',
          email: ''
        });
        
        const rules = {
          name: [{ required: true, message: '请输入您的称呼', trigger: 'blur' }],
          email: [{ required: true, message: '请输入联系方式', trigger: 'blur' }]
        };
        
        const formRef = ref(null);
        const loading = ref(false);
        const urlLoading = ref(false);
        const selectedDate = ref('');
        const selectedTimeSlot = ref(null);
        const meeting_url = ref('');
        
        const getTimeType = () => {
          return Intl.DateTimeFormat().resolvedOptions().timeZone;
        };
        
        const availableDates = computed(() => {
          const dates = [];
          const today = new Date();
          
          for (let i = 0; i < 15; i++) {
            const date = new Date(today);
            date.setDate(today.getDate() + i);
            
            dates.push({
              label: formatDateLabel(date, 'label'),
              value: formatDateValue(date, 'value')
            });
          }
          
          return dates;
        });
        
        const timeSlots = ref([]);
        
        const filteredTimeSlots = computed(() => {
          if (!selectedDate.value) return [];
          
          return timeSlots.value.filter(slot => {
            const slotDate = new Date(slot.starts_at);
            return formatDateValue(slotDate) === selectedDate.value;
          });
        });
        
        const getFormattedTimes = () => {
          // 获取当前时间
          const now = new Date();
          
          // 格式化时间为 ISO 8601 格式（UTC 时间），精确到秒
          const formatToUTC = (date) => {
            const year = date.getUTCFullYear();
            const month = String(date.getUTCMonth() + 1).padStart(2, "0");
            const day = String(date.getUTCDate()).padStart(2, "0");
            return `${year}-${month}-${day}T00:00:00Z`;
          };
          
          // 获取当前日期的 UTC 时间
          const currentUTCTime = formatToUTC(now);
          
          // 获取第 8 天的 UTC 时间
          const day8 = new Date(now);
          day8.setDate(now.getDate() + 7); // 当前日期的第 8 天
          const day8UTCTime = formatToUTC(day8);
          
          // 获取第 16 天的 UTC 时间
          const day16 = new Date(now);
          day16.setDate(now.getDate() + 15); // 当前日期的第 16 天
          const day16UTCTime = formatToUTC(day16);
          
          return {
            currentTime: currentUTCTime,
            day8Time: day8UTCTime,
            day16Time: day16UTCTime,
          };
        };
        
        const fetchTimeSlots = async () => {
          try {
            const {data:res} = await axios.get(`${baseUrl.value}/api/form/${formId.value}/meeting`);
            avatarUrl.value = res.data.profile.avatar;
            avatarName.value = res.data.profile.name;
          } catch (error) {
            console.log('err', error);
          }
          try {
            const {data:r} = await axios.get(`${baseUrl.value}/api/form/${formId.value}/meeting-timeslots?starts_at=${getFormattedTimes().currentTime}&ends_at=${getFormattedTimes().day16Time}`);
            timeSlots.value = r.data;
          } catch (error) {
            console.log('err', error);
          }
        };
        
        const formatDateLabel = (date, type) => {
          if (type == 'label') return `${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
          return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        };
        
        const formatDateValue = (date) => {
          return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        };
        
        const formatTime = (dateString) => {
          const date = new Date(dateString);
          return `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
        };
        
        const formatDateTime = (dateString) => {
          if (!dateString) return '';
          const date = new Date(dateString);
          return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')} ${formatTime(dateString)}`;
        };
        
        const selectTimeSlot = (timeSlot) => {
          if (timeSlot.available_bookings <= 0) return;
          
          selectedTimeSlot.value = timeSlot.starts_at;
          goToStep(2);
        };
        
        const goToStep = (step) => {
          currentStep.value = step;
        };
        
        const confirmBooking = async () => {
          if (!formRef.value) return;
          
          await formRef.value.validate(async (valid) => {
            if (valid) {
              loading.value = true;
              console.log('meeting_id.value', meeting_id.value);
              try {
                const {data:r} = await axios.post(`${baseUrl.value}/api/form/${formId.value}/submit-meeting`, {
                  ...formData,
                  meeting_time: selectedTimeSlot.value,
                  meeting_timezone: getTimeType(),
                  submit_id: meeting_id.value
                });
                if (r.code == 0 || r.code == 200) {
                  if (!r.data.meeting_url) {
                    ElementPlus.ElMessage.warning('预约会议失败，请重新预约！');
                    return goToStep(1);
                  }
                  meeting_url.value = r.data.meeting_url;
                  goToStep(3);
                  emit('bookingMeeting', {
                    ...formData,
                    meeting_time: selectedTimeSlot.value,
                    meeting_timezone: getTimeType(),
                    submit_id: meeting_id.value
                  });
                } else {
                  emit('bookingMeeting', false);
                }
              } catch {
                emit('bookingMeeting', false);
              } finally {
                loading.value = false;
              }
            }
          });
        };
        
        const copyMeetingInfo = () => {
          const meetingInfo = `Google会议链接：${meeting_url.value}`.trim();
          
          navigator.clipboard.writeText(meetingInfo)
            .then(() => {
              emit('copy', true);
            })
            .catch(() => {
              emit('copy', false);
            });
        };
        
        const resetDialog = () => {
          currentStep.value = 1;
          selectedTimeSlot.value = null;
          formData.name = '';
          formData.email = '';
        };
        
        const openDialog = () => {
          if (availableDates.value.length > 0) {
            selectedDate.value = availableDates.value[0].value;
          }
          fetchTimeSlots();
        };
        
        watch(() => props.submit_id, (newValue) => {
          meeting_id.value = newValue;
        });
        
        onMounted(() => {
          // Initial setup
        });
        
        return {
          avatarUrl,
          avatarName,
          dialogVisible,
          currentStep,
          formData,
          rules,
          formRef,
          loading,
          urlLoading,
          selectedDate,
          selectedTimeSlot,
          meeting_url,
          availableDates,
          timeSlots,
          filteredTimeSlots,
          formatTime,
          formatDateTime,
          selectTimeSlot,
          goToStep,
          confirmBooking,
          copyMeetingInfo,
          resetDialog,
          openDialog,
          Check
        };
      }
    };

    // Define DynamicForm component
    const DynamicForm = {
      template: `
        <div class="dynamic-form" v-if="!submitAnswer">
            <div class="form-tilte">{{ formTilte }}</div>
            <div class="form-desc">{{ formDesc }}</div>
            <div ref="formContainer" class="form-container">
                <div v-for="question in sortedQuestions" :key="question.id" class="form-item">
                    <div class="drag-handle">
                        <el-icon>
                            <Menu></Menu>
                        </el-icon>
                    </div>
                    <div class="label">{{ question.label }}</div>
                    <div class="desc">{{ question.desc }}</div>
                    <el-form :model="formData" ref="formRef">
                        <el-form-item :prop="question.question_key" :rules="getValidationRules(question)">
                            <el-input v-if="question.question_type === 'input'" v-model="formData[question.question_key]"
                                :placeholder="'请输入'+question.label" />
                            <el-input v-else-if="question.question_type === 'textarea'"
                                v-model="formData[question.question_key]" type="textarea"
                                :placeholder="'请输入'+question.label" />
                            <el-checkbox-group v-else-if="question.question_type === 'checkbox'"
                                v-model="formData[question.question_key]">
                                <el-checkbox v-for="option in question.options" :key="option.id" :label="option.content"
                                    :value="option.option_key" />
                            </el-checkbox-group>
                            <el-radio-group v-else-if="question.question_type === 'radio'"
                                v-model="formData[question.question_key]">
                                <el-radio v-for="option in question.options" :key="option.id" :label="option.content"
                                    :value="option.option_key" />
                            </el-radio-group>
                            <el-select v-else-if="question.question_type === 'select'"
                                v-model="formData[question.question_key]" :placeholder="'请选择'+question.label">
                                <el-option v-for="option in question.options" :key="option.id" :label="option.content"
                                    :value="option.option_key" />
                            </el-select>
                            <el-upload v-else-if="question.question_type === 'upload'"
                                v-model="formData[question.question_key]"
                                :on-change="(file) => handleFileChange(question.question_key, file)" :auto-upload="false"
                                :limit="limit">
                                <el-button type="primary" v-loading="uploading">点击上传</el-button>
                            </el-upload>
                        </el-form-item>
                    </el-form>
                </div>
            </div>
            <el-form-item>
                <el-button type="primary" :disabled="allowSubmit" @click="handleSubmit"
                    style="margin: 0 auto;margin-top: 20px;">提交</el-button>
            </el-form-item>
        </div>
        <div class="dynamic-form-submit" v-else>
            <img src="https://axure-file.lanhuapp.com/md5__db8ff486134077e44527103f05c17f96.png" alt="" class="submit-img">
            <div class="submit-desc" v-if="has_meeting">我们还提供了在线会议服务,您可以和销售经理面对面沟通</div>
            <el-button @click="openDialog" style="margin: 0 auto;margin-top: 20px;"
                class="bookmeeting-btn" v-if="has_meeting">立即预约会议</el-button>
            <book-meeting @booking-success="handleBookingSuccess" v-model:visible="showDialog" :submit_id="submit_id" v-if="has_meeting" />
        </div>
      `,
      components: {
        'book-meeting': BookMeeting
      },
      setup() {
        const { ref, reactive, watch, onMounted } = Vue;
        const Menu = ElementPlusIconsVue.Menu;
        
        // 固定值
        const baseUrl = ref('https://192.168.0.16:8891'); // 请替换为您的实际API基础URL
        const formId = ref('qrGDGOaTqOKX');
        const limit = ref(1);
        
        const formTilte = ref('');
        const formDesc = ref('');
        const formRef = ref(null);
        let formData = reactive({});
        let formRules = reactive({});
        const sortedQuestions = ref([]);
        const formContainer = ref(null);
        
        const allowSubmit = ref(false);
        const uploading = ref(false);
        const showDialog = ref(false);
        const submitAnswer = ref(false);
        const has_meeting = ref(null);
        const submit_id = ref('');
        
        const handleBookingSuccess = (data) => {
          console.log('预约成功', data);
        };
        
        const getValidationRules = (question) => {
          if (question.is_required) {
            if (question.question_type == 'upload') {
              return [];
            } else {
              return [{ required: true, message: `${question.label}不能为空`, trigger: 'blur' }];
            }
          } else {
            return [];
          }
        };
        
        const uploadFile = async (name, file, questionKey) => {
          if (!file) {
            return;
          }
          allowSubmit.value = true;
          uploading.value = true;
          try {
            const FormDatas = new FormData();
            FormDatas.append('question_key', questionKey);
            FormDatas.append('file', file);
            FormDatas.append('success_action_status', '200'); // 设置成功状态码
            const {data:res} = await axios.post(`${baseUrl.value}/api/form/${formId.value}/upload`, FormDatas, {
              headers: {
                'Content-Type': 'multipart/form-data',
              },
            });
            formData[questionKey] = res.data.key;
            
            if (res.code == 200 || res.code == 0) {
              console.log('上传成功');
            } else {
              console.log('上传失败');
            }
          } catch (error) {
            console.error('上传失败:', error);
          } finally {
            allowSubmit.value = false;
            uploading.value = false;
          }
        };
        
        const handleFileChange = (questionKey, file) => {
          uploadFile(file.name, file.raw, questionKey);
        };
        
        const handleSubmit = async () => {
          let isValid = true;
          
          if (isValid) {
            const submitData = JSON.parse(JSON.stringify(formData));
            
            const formattedData = sortedQuestions.value.map((question) => {
              const value = submitData[question.question_key];
              
              if (question.question_type === 'upload' && Array.isArray(value)) {
                const file = value[0];
                return {
                  question_key: question.question_key,
                  value: file.name,
                };
              }
              
              return {
                question_key: question.question_key,
                value: value || '',
              };
            });
            
            try {
              const {data:res} = await axios.post(`${baseUrl.value}/api/form/${formId.value}/submit`, { data: formattedData });
              console.log('res', res);
              if (res.code == 200 || res.code == 0) {
                formRules = {};
                formData = {};
                submit_id.value = res.data.id;
                submitAnswer.value = true;
                console.log('提交成功');
              } else {
                console.log('提交失败');
              }
              
            } catch (error) {
              console.log('error', error);
            }
          }
        };
        
        const openDialog = () => {
          showDialog.value = true;
        };
        
        onMounted(() => {
          if (formContainer.value) {
            Sortable.create(formContainer.value, {
              handle: '.drag-handle',
              animation: 150,
              onEnd: (event) => {
                const movedItem = sortedQuestions.value.splice(event.oldIndex, 1)[0];
                sortedQuestions.value.splice(event.newIndex, 0, movedItem);
              },
            });
          }
          
          // 获取表单信息
          getFormInfo();
        });
        
        const getFormInfo = async () => {
          try {
            const {data:r} = await axios.get(`${baseUrl.value}/api/form/${formId.value}/questions?page=1&size=20`);
            console.log('r',r)
            if (r.code == 0 || r.code == 200) {
              sortedQuestions.value = r.data.list;
              sortedQuestions.value.forEach((question) => {
                formData[question.question_key] = question.question_type === 'checkbox' ? [] : '';
                if (question.is_required) {
                  formRules[question.question_key] = [
                    { required: true, message: `${question.label}不能为空`, trigger: 'blur' },
                  ];
                }
              });
            }
          } catch (error) {
            console.log(error);
          }
          try {
            const {data:res} = await axios.get(`${baseUrl.value}/api/form/${formId.value}`);
            if (res.code == 0 || res.code == 200) {
              console.log('res', res);
              has_meeting.value = res.data.has_meeting;
              formTilte.value = res.data.title;
              formDesc.value = res.data.description || '调查表单';
            }
          } catch (error) {
            console.log(error);
          }
        };
        
        return {
          formTilte,
          formDesc,
          formRef,
          formData,
          sortedQuestions,
          formContainer,
          limit,
          allowSubmit,
          uploading,
          showDialog,
          submitAnswer,
          has_meeting,
          submit_id,
          handleBookingSuccess,
          getValidationRules,
          handleFileChange,
          handleSubmit,
          openDialog,
          Menu
        };
      }
    };

    // Create Vue app
    const app = Vue.createApp({
      components: {
        'dynamic-form': DynamicForm
      }
    });

    // Register Element Plus
    app.use(ElementPlus);
    
    // Register Element Plus Icons
    for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
      app.component(key, component);
    }
    
    // Mount the app
    app.mount('#app');
  </script>
</body>
</html>